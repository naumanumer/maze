import{f as e,a as t,m as l,s,N as i,b as n,c as o,d as r,B as a,e as h,o as c,w as u,g as d}from"./rxjs.es.js";function g(e,t){return e.y*t+e.x}function f(e){return`${e.x}-${e.y}`}class m extends Map{constructor(e){super(),e&&this.addAll(e)}add(e){return this.set(f(e.position),e)}addAll(e){for(let t of e)this.add(t)}hasCell(e){return this.has(f(e.position))}remove(e){return this.delete(f(e.position))}removeAll(e){for(let t of e)this.remove(t)}getRandom(){const e=Array.from(this.values());return e[Math.round(Math.random()*(e.length-1))]}}var p=["circle","defs","ellipse","filter","g","line","path","rect","svg"];function w(e,t){if("string"==typeof t||"number"==typeof t)e.innerHTML+=t.toString();else if(t instanceof Node)e.appendChild(t);else if(Array.isArray(t))for(const l of t)w(e,l)}function v(e,t,...l){let s;if(s=p.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),t)for(const e of Object.keys(t))"boolean"!=typeof t[e]?s.setAttribute(e,t[e]):t[e]&&s.setAttribute(e,"");for(const e of l)w(s,e);return s}function y(e){let t,l,s=e.length;for(;0!==s;)l=Math.floor(Math.random()*s),s-=1,t=e[s],e[s]=e[l],e[l]=t;return e}class C{getSetFromCell(e,t){for(let l of t)if(l.hasCell(e))return l}joinCellSets(e,t,l){const s=this.getSetFromCell(e,l),i=this.getSetFromCell(t,l);if(s||i)if(null==s)i.add(e);else if(null==i)s.add(t);else{s.addAll(Array.from(i.values()));const e=l.indexOf(i);l.splice(e,1)}else l.push(new m([e,t]))}isFromSameSet(e,t,l){const s=this.getSetFromCell(e,l),i=this.getSetFromCell(t,l);return!!s&&!!i&&s==i}}class z{constructor(e,t=.75){this.env=e,this.gamma=t,this.ValueTable=new Float32Array(e.stateSize),this.PolicyTable=new Float32Array(e.stateSize*e.maxActions);for(let t=0;t<e.stateSize;t++){const l=this.env.allowedActions(t);for(let s of l)this.PolicyTable[s*e.stateSize+t]=1/l.length}}act(e){const t=this.env.allowedActions(e);let l=[];for(let s of t){const t=this.PolicyTable[s*this.env.stateSize+e];l.push(t)}return t[function(e){const t=Math.random();let l=0;for(let s=0;s<e.length;s++)if(l+=e[s],l>=t)return s}(l)]}learn(){this.evaluatePolicy(),this.updatePolicy()}evaluatePolicy(){const e=new Float32Array(this.env.stateSize);for(let t=0;t<this.env.stateSize;t++){let l=0;const s=this.env.allowedActions(t);for(let e of s){const s=this.PolicyTable[e*this.env.stateSize+t];if(0===s)continue;let i=this.env.nextState(t,e);l+=s*(this.env.reward(t,e,i)+this.gamma*this.ValueTable[i])}e[t]=l}this.ValueTable=e}updatePolicy(){for(let e=0;e<this.env.stateSize;e++){const t=this.env.allowedActions(e);let l,s,i=[];for(let n of t){const o=this.env.nextState(e,n),r=this.env.reward(e,n,o)+this.gamma*this.ValueTable[o];i.push(r),n===t[0]||r>l?(l=r,s=1):r===l&&(s+=1)}for(let n=0;n<t.length;n++){const o=t[n];this.PolicyTable[o*this.env.stateSize+e]=i[n]===l?1/s:0}}}}function W(e,t){for(let l of e.cells)if(!t.has(f(l.position)))return l}function x(e,t){return Math.floor(Math.random()*(t-e)+e)}function b(e,t){return[e%t.size.height,Math.floor(e/t.size.height)]}function S([e,t],l){return t*l.size.width+e}function A(e,t,l,s=null,i=!1,n=[]){const o=new z({stateSize:t.size.height*t.size.width,maxActions:4,allowedActions(e){const l=[],[s,i]=b(e,t);return s>0&&l.push(0),i>0&&l.push(2),s<t.size.width-1&&l.push(1),i<t.size.height-1&&l.push(3),l},nextState(e,l){let[s,i]=b(e,t);return 2===l&&i--,3===l&&i++,0===l&&s--,1===l&&s++,S([s,i],t)},reward(e,l,o){const[r,a]=b(o,t),h=t.getCell({x:r,y:a});return s&&(i?!s.hasCell(h):s.hasCell(h))||n.includes(h)?-1:1}});for(;l(e,n);){n.push(e);const{x:l,y:s}=e.position;o.learn();let i=o.act(S([l,s],t));e=t.getNeighbourCell(e.position,i)}return n.includes(e)||n.push(e),n}const M={RecursiveBackTrack:new class{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);const t=new m,l=e.getRandomCell();return this.visitCell(l,t,e),e}visitCell(e,t,l){t.add(e);const s=Array.from(l.getNeighbourCells(e.position).values());for(;0!==s.length;){const i=Math.round(Math.random()*(s.length-1)),n=s[i];t.hasCell(n)||(l.removeInterWall(e.position,n.position),this.visitCell(n,t,l)),s.splice(i,1)}}},AldousBroder:new class{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);let t=e.getRandomCell();const l=new m;let s;for(l.add(t);l.size<e.size.height*e.size.width;){const i=Array.from(e.getNeighbourCells(t.position).values());if(i.filter((e=>!l.hasCell(e))).length>0){let n=i[Math.round((i.length-1)*Math.random())];l.hasCell(n)||(e.removeInterWall(n.position,t.position),l.add(n),s=null),t=n}else{if(!s){const t=e.cells.filter((e=>!l.hasCell(e)));s=t[Math.round((t.length-1)*Math.random())]}let i=Math.sign(s.position.x-t.position.x),n=0===i?Math.sign(s.position.y-t.position.y):0;t=e.getCell({x:t.position.x+i,y:t.position.y+n})}}return e}},BinaryTree:new class{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);const t=Math.random()>.5,l=Math.random()>.5;for(let s of e.cells){let i=Array.from(e.getNeighbourCells(s.position).values());if(i=i.filter((i=>{const n=e.getRelativeDirection(s.position,i.position);return l&&0==n||!l&&1==n||t&&3==n||!t&&2==n})),i.length>0){const t=i[Math.round((i.length-1)*Math.random())];e.removeInterWall(t.position,s.position)}}return e}},Eller:new class extends C{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);const t=[];for(let l=0;l<e.size.width;l++){const s=e.getCell({x:l,y:0});t.push(new m([s]))}for(let l=0;l<e.size.height-1;l++)this.visitRow(l,!1,e,t),this.visitNextRow(l,e,t);return this.visitRow(e.size.height-1,!0,e,t),e}visitRow(e,t,l,s){for(let i=1;i<l.size.width;i++){const n=l.getCell({y:e,x:i-1}),o=l.getCell({y:e,x:i});this.isFromSameSet(n,o,s)||(Math.random()>.5||t?(l.removeInterWall(n.position,o.position),this.joinCellSets(n,o,s)):null==this.getSetFromCell(n,s)?s.push(new m([n])):null==this.getSetFromCell(o,s)&&s.push(new m([o])))}}visitNextRow(e,t,l){for(let s of l){let l=Array.from(s.entries()).filter((([t,l])=>l.position.y===e)).map((([e,t])=>t));l=y(l);let i=1+Math.round(Math.random()*(l.length-1));for(let e=0;e<i;e++){const i=l[e],n=t.getCell({x:i.position.x,y:i.position.y+1});t.removeInterWall(i.position,n.position),s.add(n)}}}},Kruskal:new class extends C{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);const t=[];for(let l of e.cells)t.push(new m([l]));for(;t.length>1;){const l=e.getRandomCell(),s=Array.from(e.getNeighbourCells(l.position).values()),i=s[Math.round((s.length-1)*Math.random())];this.isFromSameSet(l,i,t)||(e.removeInterWall(l.position,i.position),this.joinCellSets(l,i,t))}return e}},HuntAndKill:new class extends C{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);const t=new m;let l=e.getRandomCell();for(;l;){let s=A(l,e,((l,s)=>{if(t.hasCell(l))return!1;return t.add(l),Array.from(e.getNeighbourCells(l.position).values()).some((e=>!t.hasCell(e)))}),t);for(let t=1;t<s.length;t++)e.removeInterWall(s[t-1].position,s[t].position);t.addAll(s),l=this.hunt(e,t)}return e}hunt(e,t){for(let l of e.cells){if(t.hasCell(l))continue;const s=Array.from(e.getNeighbourCells(l.position).values());for(let i of s)if(t.hasCell(i))return e.removeInterWall(l.position,i.position),l}}},PrimsRandomization:new class{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);const t=new m;let l=e.getRandomCell();const s=new m(Array.from(e.getNeighbourCells(l.position).values()));for(t.add(l);s.size>0;){l=s.getRandom();const i=new m(Array.from(e.getNeighbourCells(l.position).values()));for(let n of i.values())if(t.hasCell(n)){e.removeInterWall(n.position,l.position),s.remove(l),t.add(l),s.addAll(Array.from(i.values())),s.removeAll(Array.from(t.values()));break}}return e}},Wilson:new class{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);const t=new m;for(t.add(e.getRandomCell());t.size<e.size.height*e.size.width;){let l=A(W(e,t),e,((e,l)=>{if(l.includes(e)){const t=l.indexOf(e);l.splice(t,l.length)}return!t.hasCell(e)}));for(let t=1;t<l.length;t++)e.removeInterWall(l[t-1].position,l[t].position);t.addAll(l)}return e}},Sidewinder:new class{generate(e){(e=e.clone()).cells[0].removeWall(0),e.cells[e.cells.length-1].removeWall(1);for(let t=1;t<e.size.width;t++)e.removeInterWall({y:0,x:t},{y:0,x:t-1});for(let t=1;t<e.size.height;t++)this.visitRow(t,e);return e}visitRow(e,t){let l=0;for(let s=1;s<t.size.width;s++)if(Math.random()>.5)t.removeInterWall({y:e,x:s-1},{y:e,x:s}),l++;else{const i=x(s-1-l,s);t.removeInterWall({y:e,x:i},{y:e-1,x:i}),l=0}const s=x(t.size.width-l-1,t.size.width);t.removeInterWall({y:e,x:s},{y:e-1,x:s})}}},R={0:1,1:0,2:3,3:2};class ${constructor(e){this.position=e,this.walls=new Map,this.setAllWalls()}setAllWalls(){this.setWall(2),this.setWall(1),this.setWall(3),this.setWall(0)}removeAllWalls(){this.removeWall(2),this.removeWall(1),this.removeWall(3),this.removeWall(0)}setWall(e){this.walls.set(e,!0)}removeWall(e){this.walls.set(e,!1)}hasWall(e){return this.walls.get(e)}clone(){const e=new $(this.position);for(const[t,l]of this.walls.entries())e.walls.set(t,l);return e}}class T{constructor(e,t){this.size={height:t,width:e},this.cells=[],this.initCells()}initCells(){for(let e=0;e<this.size.height;e++)for(let t=0;t<this.size.width;t++)this.cells.push(new $({x:t,y:e}))}getRandomCell(){return this.cells[Math.round(Math.random()*(this.cells.length-1))]}getCell(e){return this.cells[g(e,this.size.width)]}getNeighbourCells(e,t=!1){let l=new Map,s=g(e,this.size.width);if(s>=this.size.width){const e=this.cells[s-this.size.width];l.set(2,e)}if((s+1)%this.size.width!=0){const e=this.cells[s+1];l.set(1,e)}if(s<this.cells.length-this.size.width){const e=this.cells[s+this.size.width];l.set(3,e)}if(s%this.size.width!=0){const e=this.cells[s-1];l.set(0,e)}if(t){const t=Array.from(l.entries()).filter((([t,l])=>!this.hasInterWall(l.position,e)));l=new Map(t)}return l}getNeighbourCell(e,t){return this.getNeighbourCells(e).get(t)}getRelativeDirection(e,t){if(e.y===t.y+1)return 2;if(e.x===t.x-1)return 1;if(e.x===t.x+1)return 0;if(e.y===t.y-1)return 3;throw`'${e}' and '${t}' are not neighbours`}removeInterWall(e,t){const l=this.getRelativeDirection(e,t),s=R[l];this.getCell(e).removeWall(l),this.getCell(t).removeWall(s)}addInterWall(e,t){const l=this.getRelativeDirection(e,t),s=R[l];this.getCell(e).setWall(l),this.getCell(t).setWall(s)}hasInterWall(e,t){const l=this.getRelativeDirection(e,t),s=R[l];return this.getCell(e).hasWall(l)&&this.getCell(t).hasWall(s)}isConnected(e,t){const l=this.getRelativeDirection(e,t),s=R[l];return this.getCell(e).hasWall(l)&&this.getCell(t).hasWall(s)}hasWall(e,t){return this.getCell(e).hasWall(t)}clone(){const e=new T(this.size.width,this.size.height);for(let t=0;t<e.cells.length;t++)e.cells[t]=this.cells[t].clone();return e}}const I=new a(null);function P(){I.next(I.getValue())}function E({x:e,y:t}){const{width:l,height:s}=I.getValue();return e===l-1&&t===s-1}function N(){return I.pipe(t((e=>!!e)),h((async({width:e,height:t,generator:l})=>{let s=new T(e,t);return l.generate(s)})),s())}class k{constructor(){this.cellSize=30,this.lineWidth=2,this.playerPadding=7,document.documentElement.style.setProperty("--cell-size",this.cellSize+"px")}render(e,t){const l=this.cellSize*(e.size.width+2)+this.lineWidth,s=this.cellSize*(e.size.height+2)+this.lineWidth,i=this.renderPlayer();t.subscribe((({position:e})=>{const[t,l]=[e.x,e.y].map((e=>this.cellSize*e+this.playerPadding+this.cellSize));i.setAttribute("x",t+""),i.setAttribute("y",l+"")}));let n=e.cells.map((t=>this.renderCell(t,e.size))).join("");return v("svg",{stroke:"currentColor",fill:"none",width:l,height:s,viewBox:`0 0 ${l} ${s}`},i,v("path",{d:n,class:"maze-wall","stroke-width":this.lineWidth,"stroke-linecap":"round"}))}renderPlayer(){const e=this.cellSize-2*this.playerPadding;return v("rect",{width:e,height:e,fill:"currentColor",class:"text-blue-500","stroke-width":"0",rx:"3",id:"player",x:1+this.playerPadding+this.cellSize,y:1+this.playerPadding+this.cellSize})}renderCell(e,t){const l=e.position.x*this.cellSize+this.lineWidth/2+this.cellSize,s=e.position.y*this.cellSize+this.lineWidth/2+this.cellSize;let i="";return e.hasWall(2)&&(i+=`M${l},${s}H${l+this.cellSize}`),e.hasWall(0)&&(i+=`M${l},${s}V${s+this.cellSize}`),e.position.x+1===t.width&&e.hasWall(1)&&(i+=`M${l+this.cellSize},${s}V${s+this.cellSize}`),e.position.y+1===t.height&&(i+=`M${l},${s+this.cellSize}H${l+this.cellSize}`),i}}var F;!function(e){e[e.rectangularSvg=0]="rectangularSvg"}(F||(F={}));var V=new class{constructor(){this.renderers=new Map}async loadRenderer(e){if(this.renderers.has(e))return this.renderers.get(e);let t;switch(e){case F.rectangularSvg:t=k}const l=new t;return this.renderers.set(e,l),l}};const D={ArrowRight:1,ArrowLeft:0,ArrowUp:2,ArrowDown:3},j=new a({state:"active",position:{x:0,y:0}});function B(e){const{state:t}=j.getValue();j.next({state:t,position:e})}function H(e){const{position:t}=j.getValue();j.next({state:e,position:t})}function L({keyboard$:e,swipe$:s,board$:i}){i.subscribe((()=>{const{position:{x:e,y:t}}=j.getValue();0===e&&0===t||B({x:0,y:0})}));return r(e,s).pipe(l((e=>e.type?{dir:D[e.type]}:e))).pipe(u(i),t((([{dir:e},t])=>{const{position:{x:l,y:s},state:i}=j.getValue();return"active"===i&&!t.hasWall({x:l,y:s},e)}))).subscribe((([{dir:e},t])=>{!function(e,t){let{position:{x:l,y:s}}=j.getValue();for(;;){1===e&&l<t.size.width-1?l++:0===e&&l>0?l--:2===e&&s>0?s--:3===e&&s<t.size.height-1&&s++;const i=t.getNeighbourCells({x:l,y:s},!0);if(!i.has(e)||i.size>2)break}B({x:l,y:s})}(e,t)})),j.pipe(c(d))}const K=document.getElementById("board"),O=document.getElementById("boardWrapper"),U=document.getElementById("reset");var X;!function({keyboard$:e,swipe$:l,boardEl:s}){!function(e){e.subscribe((({type:e})=>{"r"===e.toLowerCase()&&P()}))}(e);const i=N(),n=L({keyboard$:e,board$:i,swipe$:l});i.subscribe((e=>{H("active"),V.loadRenderer(F.rectangularSvg).then((t=>{!function(e){for(;e.lastElementChild;)e.removeChild(e.lastElementChild)}(s),s.appendChild(t.render(e,n))}))})),n.pipe(t((({position:e,state:t})=>E(e)&&"active"===t))).subscribe((async({position:{x:e,y:t}})=>{const l=(new Date).getTime();let s;H("inactive");try{const e=await import("./confetti.module.es.js");s=e.default}catch(e){console.error(e)}const i=(new Date).getTime()-l;i>=250?(B({x:e+1,y:t}),s&&s({origin:{y:.8},particleCount:100}).then()):setTimeout((()=>{B({x:e+1,y:t}),s&&s({origin:{y:.8},particleCount:100}).then()}),250-i)}))}({keyboard$:e(window,"keydown").pipe(t((e=>!(e.metaKey||e.ctrlKey))),l((e=>({type:e.key,claim(){e.preventDefault(),e.stopPropagation()}}))),t((()=>{const e=document.activeElement instanceof HTMLElement?document.activeElement:void 0;return void 0===e||!function(e){switch(e.tagName){case"INPUT":case"SELECT":case"TEXTAREA":return!0;default:return e.isContentEditable}}(e)})),s()),swipe$:function(t=document.documentElement){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?n(import("./hammer.es.js").then((function(e){return e.h}))).pipe(o((l=>{const s=new l.Manager(t);return s.add(new l.Swipe),r(e(s,"swipeleft"),e(s,"swiperight"),e(s,"swipeup"),e(s,"swipedown"))})),l((({type:e})=>({dir:e.slice(5)}))),s()):i}(O),boardEl:K}),X={height:15,width:15,generator:M.RecursiveBackTrack},I.next(X),e(U,"click").subscribe(P);
//# sourceMappingURL=main.es.js.map
