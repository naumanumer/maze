import{f as e,a as t,m as l,s as i,N as s,b as o,c as n,d as r,B as a,e as h,o as c,w as d,g as u}from"./rxjs.es.js";function g(e,t){return e.y*t+e.x}function f(e){return`${e.x}-${e.y}`}class p extends Map{constructor(e){super(),e&&this.addAll(e)}add(e){return this.set(f(e.position),e)}addAll(e){for(let t of e)this.add(t)}hasCell(e){return this.has(f(e.position))}remove(e){return this.delete(f(e.position))}removeAll(e){for(let t of e)this.remove(t)}getRandom(){const e=Array.from(this.values());return e[Math.round(Math.random()*(e.length-1))]}}var m=["circle","defs","ellipse","filter","g","line","path","rect","svg"];function w(e,t){if("string"==typeof t||"number"==typeof t)e.innerHTML+=t.toString();else if(t instanceof Node)e.appendChild(t);else if(Array.isArray(t))for(const l of t)w(e,l)}function v(e,t,...l){let i;if(i=m.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),t)for(const e of Object.keys(t))"boolean"!=typeof t[e]?i.setAttribute(e,t[e]):t[e]&&i.setAttribute(e,"");for(const e of l)w(i,e);return i}function y(e){let t,l,i=e.length;for(;0!==i;)l=Math.floor(Math.random()*i),i-=1,t=e[i],e[i]=e[l],e[l]=t;return e}class W{getSetFromCell(e,t){for(let l of t)if(l.hasCell(e))return l}joinCellSets(e,t,l){const i=this.getSetFromCell(e,l),s=this.getSetFromCell(t,l);if(i||s)if(null==i)s.add(e);else if(null==s)i.add(t);else{i.addAll(Array.from(s.values()));const e=l.indexOf(s);l.splice(e,1)}else l.push(new p([e,t]))}isFromSameSet(e,t,l){const i=this.getSetFromCell(e,l),s=this.getSetFromCell(t,l);return!!i&&!!s&&i==s}}function C(e,t){for(let l of e.cells)if(!t.has(f(l.position)))return l}function x(e,t){return Math.floor(Math.random()*(t-e)+e)}const z={RecursiveBackTrack:new class{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=new p,l=e.getRandomCell();return this.visitCell(l,t,e),e}visitCell(e,t,l){t.add(e);const i=Array.from(l.getNeighbourCells(e.position).values());for(;0!==i.length;){const s=Math.round(Math.random()*(i.length-1)),o=i[s];t.hasCell(o)||(l.removeInterWall(e.position,o.position),this.visitCell(o,t,l)),i.splice(s,1)}}},AldousBroder:new class{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");let t=e.getRandomCell();const l=new p;let i;for(l.add(t);l.size<e.size.height*e.size.width;){const s=Array.from(e.getNeighbourCells(t.position).values());if(s.filter((e=>!l.hasCell(e))).length>0){let o=s[Math.round((s.length-1)*Math.random())];l.hasCell(o)||(e.removeInterWall(o.position,t.position),l.add(o),i=null),t=o}else{if(!i){const t=e.cells.filter((e=>!l.hasCell(e)));i=t[Math.round((t.length-1)*Math.random())]}let s=Math.sign(i.position.x-t.position.x),o=0===s?Math.sign(i.position.y-t.position.y):0;t=e.getCell({x:t.position.x+s,y:t.position.y+o})}}return e}},BinaryTree:new class{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=Math.random()>.5,l=Math.random()>.5;for(let i of e.cells){let s=Array.from(e.getNeighbourCells(i.position).values());if(s=s.filter((s=>{const o=e.getRelativeDirection(i.position,s.position);return l&&"left"==o||!l&&"right"==o||t&&"down"==o||!t&&"up"==o})),s.length>0){const t=s[Math.round((s.length-1)*Math.random())];e.removeInterWall(t.position,i.position)}}return e}},Eller:new class extends W{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=[];for(let l=0;l<e.size.width;l++){const i=e.getCell({x:l,y:0});t.push(new p([i]))}for(let l=0;l<e.size.height-1;l++)this.visitRow(l,!1,e,t),this.visitNextRow(l,e,t);return this.visitRow(e.size.height-1,!0,e,t),e}visitRow(e,t,l,i){for(let s=1;s<l.size.width;s++){const o=l.getCell({y:e,x:s-1}),n=l.getCell({y:e,x:s});this.isFromSameSet(o,n,i)||(Math.random()>.5||t?(l.removeInterWall(o.position,n.position),this.joinCellSets(o,n,i)):null==this.getSetFromCell(o,i)?i.push(new p([o])):null==this.getSetFromCell(n,i)&&i.push(new p([n])))}}visitNextRow(e,t,l){for(let i of l){let l=Array.from(i.entries()).filter((([t,l])=>l.position.y===e)).map((([e,t])=>t));l=y(l);let s=1+Math.round(Math.random()*(l.length-1));for(let e=0;e<s;e++){const s=l[e],o=t.getCell({x:s.position.x,y:s.position.y+1});t.removeInterWall(s.position,o.position),i.add(o)}}}},Kruskal:new class extends W{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=[];for(let l of e.cells)t.push(new p([l]));for(;t.length>1;){const l=e.getRandomCell(),i=Array.from(e.getNeighbourCells(l.position).values()),s=i[Math.round((i.length-1)*Math.random())];this.isFromSameSet(l,s,t)||(e.removeInterWall(l.position,s.position),this.joinCellSets(l,s,t))}return e}},HuntAndKill:new class extends W{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=new p;let l=C(e,t);for(;l;){const i=Array.from(e.getNeighbourCells(l.position).values());for(let s of i)if(t.has(f(s.position))){e.removeInterWall(l.position,s.position);break}this.randomWalk(l,e,t),l=C(e,t)}return e}randomWalk(e,t,l){l.add(e);let i=Array.from(t.getNeighbourCells(e.position).values());if(i=i.filter((e=>!l.hasCell(e))),0===i.length)return;const s=i[Math.round(Math.random()*(i.length-1))];l.hasCell(s)||(t.removeInterWall(e.position,s.position),l.add(s),this.randomWalk(s,t,l))}},PrimsRandomization:new class{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=new p;let l=e.getRandomCell();const i=new p(Array.from(e.getNeighbourCells(l.position).values()));for(t.add(l);i.size>0;){l=i.getRandom();const s=new p(Array.from(e.getNeighbourCells(l.position).values()));for(let o of s.values())if(t.hasCell(o)){e.removeInterWall(o.position,l.position),i.remove(l),t.add(l),i.addAll(Array.from(s.values())),i.removeAll(Array.from(t.values()));break}}return e}},Wilson:new class{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=new p;for(t.add(e.getRandomCell());t.size<e.size.height*e.size.width;){let i=C(e,t),s=[i];for(;!t.hasCell(i);){const t=Array.from(e.getNeighbourCells(i.position).values());i=(l=t)[Math.round(Math.random()*(l.length-1))],s.includes(i)&&(s=s.slice(0,s.indexOf(i))),s.push(i)}for(let t=1;t<s.length;t++)e.removeInterWall(s[t-1].position,s[t].position);t.addAll(s)}var l;return e}},Sidewinder:new class{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");for(let t=1;t<e.size.width;t++)e.removeInterWall({y:0,x:t},{y:0,x:t-1});for(let t=1;t<e.size.height;t++)this.visitRow(t,e);return e}visitRow(e,t){let l=0;for(let i=1;i<t.size.width;i++)if(Math.random()>.5)t.removeInterWall({y:e,x:i-1},{y:e,x:i}),l++;else{const s=x(i-1-l,i);t.removeInterWall({y:e,x:s},{y:e-1,x:s}),l=0}const i=x(t.size.width-l-1,t.size.width);t.removeInterWall({y:e,x:i},{y:e-1,x:i})}}},b={left:"right",right:"left",up:"down",down:"up"};class S{constructor(e){this.position=e,this.walls=new Map,this.setAllWalls()}setAllWalls(){this.setWall("up"),this.setWall("right"),this.setWall("down"),this.setWall("left")}removeAllWalls(){this.removeWall("up"),this.removeWall("right"),this.removeWall("down"),this.removeWall("left")}setWall(e){this.walls.set(e,!0)}removeWall(e){this.walls.set(e,!1)}hasWall(e){return this.walls.get(e)}clone(){const e=new S(this.position);for(const[t,l]of this.walls.entries())e.walls.set(t,l);return e}}class M{constructor(e,t){this.size={height:t,width:e},this.cells=[],this.initCells()}initCells(){for(let e=0;e<this.size.height;e++)for(let t=0;t<this.size.width;t++)this.cells.push(new S({x:t,y:e}))}getRandomCell(){return this.cells[Math.round(Math.random()*(this.cells.length-1))]}getCell(e){return this.cells[g(e,this.size.width)]}getNeighbourCells(e,t=!1){let l=new Map,i=g(e,this.size.width);if(i>=this.size.width){const e=this.cells[i-this.size.width];l.set("up",e)}if((i+1)%this.size.width!=0){const e=this.cells[i+1];l.set("right",e)}if(i<this.cells.length-this.size.width){const e=this.cells[i+this.size.width];l.set("down",e)}if(i%this.size.width!=0){const e=this.cells[i-1];l.set("left",e)}if(t){const t=Array.from(l.entries()).filter((([t,l])=>!this.hasInterWall(l.position,e)));l=new Map(t)}return l}getNeighbourCell(e,t){return this.getNeighbourCells(e).get(t)}getRelativeDirection(e,t){if(e.y===t.y+1)return"up";if(e.x===t.x-1)return"right";if(e.x===t.x+1)return"left";if(e.y===t.y-1)return"down";throw`'${e}' and '${t}' are not neighbours`}removeInterWall(e,t){const l=this.getRelativeDirection(e,t),i=b[l];this.getCell(e).removeWall(l),this.getCell(t).removeWall(i)}addInterWall(e,t){const l=this.getRelativeDirection(e,t),i=b[l];this.getCell(e).setWall(l),this.getCell(t).setWall(i)}hasInterWall(e,t){const l=this.getRelativeDirection(e,t),i=b[l];return this.getCell(e).hasWall(l)&&this.getCell(t).hasWall(i)}isConnected(e,t){const l=this.getRelativeDirection(e,t),i=b[l];return this.getCell(e).hasWall(l)&&this.getCell(t).hasWall(i)}hasWall(e,t){return this.getCell(e).hasWall(t)}clone(){const e=new M(this.size.width,this.size.height);for(let t=0;t<e.cells.length;t++)e.cells[t]=this.cells[t].clone();return e}}const A=new a(null);function R(){A.next(A.getValue())}function $({x:e,y:t}){const{width:l,height:i}=A.getValue();return e===l-1&&t===i-1}function k(){return A.pipe(t((e=>!!e)),h((async({width:e,height:t,generator:l})=>{let i=new M(e,t);return l.generate(i)})),i())}class I{constructor(){this.cellSize=30,this.lineWidth=2,this.playerPadding=7,document.documentElement.style.setProperty("--cell-size",this.cellSize+"px")}render(e,t){const l=this.cellSize*(e.size.width+2)+this.lineWidth,i=this.cellSize*(e.size.height+2)+this.lineWidth,s=this.renderPlayer();t.subscribe((({position:e})=>{const[t,l]=[e.x,e.y].map((e=>this.cellSize*e+this.playerPadding+this.cellSize));s.setAttribute("x",t+""),s.setAttribute("y",l+"")}));let o=e.cells.map((t=>this.renderCell(t,e.size))).join("");return v("svg",{stroke:"currentColor",fill:"none",width:l,height:i,viewBox:`0 0 ${l} ${i}`},s,v("path",{d:o,class:"maze-wall","stroke-width":this.lineWidth,"stroke-linecap":"round"}))}renderPlayer(){const e=this.cellSize-2*this.playerPadding;return v("rect",{width:e,height:e,fill:"currentColor",class:"text-blue-500","stroke-width":"0",rx:"3",id:"player",x:1+this.playerPadding+this.cellSize,y:1+this.playerPadding+this.cellSize})}renderCell(e,t){const l=e.position.x*this.cellSize+this.lineWidth/2+this.cellSize,i=e.position.y*this.cellSize+this.lineWidth/2+this.cellSize;let s="";return e.hasWall("up")&&(s+=`M${l},${i}H${l+this.cellSize}`),e.hasWall("left")&&(s+=`M${l},${i}V${i+this.cellSize}`),e.position.x+1===t.width&&e.hasWall("right")&&(s+=`M${l+this.cellSize},${i}V${i+this.cellSize}`),e.position.y+1===t.height&&(s+=`M${l},${i+this.cellSize}H${l+this.cellSize}`),s}}var E;!function(e){e[e.rectangularSvg=0]="rectangularSvg"}(E||(E={}));var N=new class{constructor(){this.renderers=new Map}async loadRenderer(e){if(this.renderers.has(e))return this.renderers.get(e);let t;switch(e){case E.rectangularSvg:t=I}const l=new t;return this.renderers.set(e,l),l}};const T={ArrowRight:"right",ArrowLeft:"left",ArrowUp:"up",ArrowDown:"down"},P=new a({state:"active",position:{x:0,y:0}});function D(e){const{state:t}=P.getValue();P.next({state:t,position:e})}function F(e){const{position:t}=P.getValue();P.next({state:e,position:t})}function j({keyboard$:e,swipe$:i,board$:s}){s.subscribe((()=>{const{position:{x:e,y:t}}=P.getValue();0===e&&0===t||D({x:0,y:0})}));return r(e,i).pipe(l((e=>e.type?{dir:T[e.type]}:e))).pipe(d(s),t((([{dir:e},t])=>{const{position:{x:l,y:i},state:s}=P.getValue();return"active"===s&&!t.hasWall({x:l,y:i},e)}))).subscribe((([{dir:e},t])=>{!function(e,t){let{position:{x:l,y:i}}=P.getValue();for(;;){"right"===e&&l<t.size.width-1?l++:"left"===e&&l>0?l--:"up"===e&&i>0?i--:"down"===e&&i<t.size.height-1&&i++;const s=t.getNeighbourCells({x:l,y:i},!0);if(!s.has(e)||s.size>2)break}D({x:l,y:i})}(e,t)})),P.pipe(c(u))}const B=document.getElementById("board"),V=document.getElementById("boardWrapper"),H=document.getElementById("reset");var L;!function({keyboard$:e,swipe$:l,boardEl:i}){!function(e){e.subscribe((({type:e})=>{"r"===e.toLowerCase()&&R()}))}(e);const s=k(),o=j({keyboard$:e,board$:s,swipe$:l});s.subscribe((e=>{F("active"),N.loadRenderer(E.rectangularSvg).then((t=>{!function(e){for(;e.lastElementChild;)e.removeChild(e.lastElementChild)}(i),i.appendChild(t.render(e,o))}))})),o.pipe(t((({position:e,state:t})=>$(e)&&"active"===t))).subscribe((async({position:{x:e,y:t}})=>{const l=(new Date).getTime();let i;F("inactive");try{const e=await import("./confetti.module.es.js");i=e.default}catch(e){console.error(e)}const s=(new Date).getTime()-l;s>=250?(D({x:e+1,y:t}),i&&i({origin:{y:.8},particleCount:100}).then()):setTimeout((()=>{D({x:e+1,y:t}),i&&i({origin:{y:.8},particleCount:100}).then()}),250-s)}))}({keyboard$:e(window,"keydown").pipe(t((e=>!(e.metaKey||e.ctrlKey))),l((e=>({type:e.key,claim(){e.preventDefault(),e.stopPropagation()}}))),t((()=>{const e=document.activeElement instanceof HTMLElement?document.activeElement:void 0;return void 0===e||!function(e){switch(e.tagName){case"INPUT":case"SELECT":case"TEXTAREA":return!0;default:return e.isContentEditable}}(e)})),i()),swipe$:function(t=document.documentElement){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?o(import("./hammer.es.js").then((function(e){return e.h}))).pipe(n((l=>{const i=new l.Manager(t);return i.add(new l.Swipe),r(e(i,"swipeleft"),e(i,"swiperight"),e(i,"swipeup"),e(i,"swipedown"))})),l((({type:e})=>({dir:e.slice(5)}))),i()):s}(V),boardEl:B}),L={height:15,width:15,generator:z.RecursiveBackTrack},A.next(L),e(H,"click").subscribe(R);
//# sourceMappingURL=main.es.js.map
