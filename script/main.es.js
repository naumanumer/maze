import{f as e,a as t,m as i,s,N as l,b as n,c as r,d as o,B as a,e as h,o as c,w as u,g as d}from"./rxjs.es.js";var g=["circle","defs","ellipse","filter","g","line","path","rect","svg"];function p(e,t){if("string"==typeof t||"number"==typeof t)e.innerHTML+=t.toString();else if(t instanceof Node)e.appendChild(t);else if(Array.isArray(t))for(const i of t)p(e,i)}function w(e,t,...i){let s;if(s=g.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),t)for(const e of Object.keys(t))"boolean"!=typeof t[e]?s.setAttribute(e,t[e]):t[e]&&s.setAttribute(e,"");for(const e of i)p(s,e);return s}function f(e,t){return e.y*t+e.x}function y(e){return`${e.x}-${e.y}`}const m={recursiveBackTrack:new class{generate(e){(e=e.clone()).cells[0].removeWall("left"),e.cells[e.cells.length-1].removeWall("right");const t=new Set,i=e.getRandomCell();return this.visitCell(i,t,e),e}visitCell(e,t,i){t.add(y(e.position));const s=Array.from(i.getNeighbourCells(e.position).values());for(;0!==s.length;){const l=Math.round(Math.random()*(s.length-1)),n=s[l];t.has(y(n.position))||(i.removeInterWall(e.position,n.position),this.visitCell(n,t,i)),s.splice(l,1)}}}},v={left:"right",right:"left",up:"down",down:"up"};class W{constructor(e){this.position=e,this.walls=new Map,this.setAllWalls()}setAllWalls(){this.setWall("up"),this.setWall("right"),this.setWall("down"),this.setWall("left")}removeAllWalls(){this.removeWall("up"),this.removeWall("right"),this.removeWall("down"),this.removeWall("left")}setWall(e){this.walls.set(e,!0)}removeWall(e){this.walls.set(e,!1)}hasWall(e){return this.walls.get(e)}clone(){const e=new W(this.position);for(const[t,i]of this.walls.entries())e.walls.set(t,i);return e}}class b{constructor(e,t){this.size={height:t,width:e},this.cells=[],this.initCells()}initCells(){for(let e=0;e<this.size.height;e++)for(let t=0;t<this.size.width;t++)this.cells.push(new W({x:t,y:e}))}getRandomCell(){return this.cells[Math.round(Math.random()*(this.cells.length-1))]}getCell(e){return this.cells[f(e,this.size.width)]}getNeighbourCells(e,t=!1){let i=new Map,s=f(e,this.size.width);if(s>=this.size.width){const e=this.cells[s-this.size.width];i.set("up",e)}if((s+1)%this.size.width!=0){const e=this.cells[s+1];i.set("right",e)}if(s<this.cells.length-this.size.width){const e=this.cells[s+this.size.width];i.set("down",e)}if(s%this.size.width!=0){const e=this.cells[s-1];i.set("left",e)}if(t){const t=Array.from(i.entries()).filter((([t,i])=>!this.hasInterWall(i.position,e)));i=new Map(t)}return i}getNeighbourCell(e,t){return this.getNeighbourCells(e).get(t)}getRelativeDirection(e,t){if(e.y===t.y+1)return"up";if(e.x===t.x-1)return"right";if(e.x===t.x+1)return"left";if(e.y===t.y-1)return"down";throw`'${e}' and '${t}' are not neighbours`}removeInterWall(e,t){const i=this.getRelativeDirection(e,t),s=v[i];this.getCell(e).removeWall(i),this.getCell(t).removeWall(s)}addInterWall(e,t){const i=this.getRelativeDirection(e,t),s=v[i];this.getCell(e).setWall(i),this.getCell(t).setWall(s)}hasInterWall(e,t){const i=this.getRelativeDirection(e,t),s=v[i];return this.getCell(e).hasWall(i)&&this.getCell(t).hasWall(s)}isConnected(e,t){const i=this.getRelativeDirection(e,t),s=v[i];return this.getCell(e).hasWall(i)&&this.getCell(t).hasWall(s)}hasWall(e,t){return this.getCell(e).hasWall(t)}clone(){const e=new b(this.size.width,this.size.height);for(let t=0;t<e.cells.length;t++)e.cells[t]=this.cells[t].clone();return e}}const z=new a(null);function C(){z.next(z.getValue())}function x({x:e,y:t}){const{width:i,height:s}=z.getValue();return e===i-1&&t===s-1}function S(){return z.pipe(t((e=>!!e)),h((async({width:e,height:t,generator:i})=>{let s=new b(e,t);return i.generate(s)})),s())}class ${constructor(){this.cellSize=30,this.lineWidth=2,this.playerPadding=7,document.documentElement.style.setProperty("--cell-size",this.cellSize+"px")}render(e,t){const i=this.cellSize*(e.size.width+2)+this.lineWidth,s=this.cellSize*(e.size.height+2)+this.lineWidth,l=this.renderPlayer();t.subscribe((({position:e})=>{const[t,i]=[e.x,e.y].map((e=>this.cellSize*e+this.playerPadding+this.cellSize));l.setAttribute("x",t+""),l.setAttribute("y",i+"")}));let n=e.cells.map((t=>this.renderCell(t,e.size))).join("");return w("svg",{stroke:"currentColor",fill:"none",width:i,height:s,viewBox:`0 0 ${i} ${s}`},l,w("path",{d:n,class:"maze-wall","stroke-width":this.lineWidth,"stroke-linecap":"round"}))}renderPlayer(){const e=this.cellSize-2*this.playerPadding;return w("rect",{width:e,height:e,fill:"currentColor",class:"text-blue-500","stroke-width":"0",rx:"3",id:"player",x:1+this.playerPadding+this.cellSize,y:1+this.playerPadding+this.cellSize})}renderCell(e,t){const i=e.position.x*this.cellSize+this.lineWidth/2+this.cellSize,s=e.position.y*this.cellSize+this.lineWidth/2+this.cellSize;let l="";return e.hasWall("up")&&(l+=`M${i},${s}H${i+this.cellSize}`),e.hasWall("left")&&(l+=`M${i},${s}V${s+this.cellSize}`),e.position.x+1===t.width&&e.hasWall("right")&&(l+=`M${i+this.cellSize},${s}V${s+this.cellSize}`),e.position.y+1===t.height&&(l+=`M${i},${s+this.cellSize}H${i+this.cellSize}`),l}}var E;!function(e){e[e.rectangularSvg=0]="rectangularSvg"}(E||(E={}));var k=new class{constructor(){this.renderers=new Map}async loadRenderer(e){if(this.renderers.has(e))return this.renderers.get(e);let t;switch(e){case E.rectangularSvg:t=$}const i=new t;return this.renderers.set(e,i),i}};const A={ArrowRight:"right",ArrowLeft:"left",ArrowUp:"up",ArrowDown:"down"},M=new a({state:"active",position:{x:0,y:0}});function T(e){const{state:t}=M.getValue();M.next({state:t,position:e})}function P(e){const{position:t}=M.getValue();M.next({state:e,position:t})}function R({keyboard$:e,swipe$:s,board$:l}){l.subscribe((()=>{const{position:{x:e,y:t}}=M.getValue();0===e&&0===t||T({x:0,y:0})}));return o(e,s).pipe(i((e=>e.type?{dir:A[e.type]}:e))).pipe(u(l),t((([{dir:e},t])=>{const{position:{x:i,y:s},state:l}=M.getValue();return"active"===l&&!t.hasWall({x:i,y:s},e)}))).subscribe((([{dir:e},t])=>{!function(e,t){let{position:{x:i,y:s}}=M.getValue();for(;;){"right"===e&&i<t.size.width-1?i++:"left"===e&&i>0?i--:"up"===e&&s>0?s--:"down"===e&&s<t.size.height-1&&s++;const l=t.getNeighbourCells({x:i,y:s},!0);if(!l.has(e)||l.size>2)break}T({x:i,y:s})}(e,t)})),M.pipe(c(d))}const N=document.getElementById("board"),D=document.getElementById("boardWrapper"),I=document.getElementById("reset");var V;!function({keyboard$:e,swipe$:i,boardEl:s}){!function(e){e.subscribe((({type:e})=>{"r"===e.toLowerCase()&&C()}))}(e);const l=S(),n=R({keyboard$:e,board$:l,swipe$:i});l.subscribe((e=>{P("active"),k.loadRenderer(E.rectangularSvg).then((t=>{!function(e){for(;e.lastElementChild;)e.removeChild(e.lastElementChild)}(s),s.appendChild(t.render(e,n))}))})),n.pipe(t((({position:e,state:t})=>x(e)&&"active"===t))).subscribe((async({position:{x:e,y:t}})=>{const i=(new Date).getTime();let s;P("inactive");try{const e=await import("./confetti.module.es.js");s=e.default}catch(e){console.error(e)}const l=(new Date).getTime()-i;l>=250?(T({x:e+1,y:t}),s&&s({origin:{y:.8},particleCount:100}).then()):setTimeout((()=>{T({x:e+1,y:t}),s&&s({origin:{y:.8},particleCount:100}).then()}),250-l)}))}({keyboard$:e(window,"keydown").pipe(t((e=>!(e.metaKey||e.ctrlKey))),i((e=>({type:e.key,claim(){e.preventDefault(),e.stopPropagation()}}))),t((()=>{const e=document.activeElement instanceof HTMLElement?document.activeElement:void 0;return void 0===e||!function(e){switch(e.tagName){case"INPUT":case"SELECT":case"TEXTAREA":return!0;default:return e.isContentEditable}}(e)})),s()),swipe$:function(t=document.documentElement){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?n(import("./hammer.es.js").then((function(e){return e.h}))).pipe(r((i=>{const s=new i.Manager(t);return s.add(new i.Swipe),o(e(s,"swipeleft"),e(s,"swiperight"),e(s,"swipeup"),e(s,"swipedown"))})),i((({type:e})=>({dir:e.slice(5)}))),s()):l}(D),boardEl:N}),V={height:5,width:5,generator:m.recursiveBackTrack},z.next(V),e(I,"click").subscribe(C);
//# sourceMappingURL=main.es.js.map
